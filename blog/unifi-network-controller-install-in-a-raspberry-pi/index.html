<!DOCTYPE html>
<html>
  <head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-180348489-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-180348489-1');
    </script>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content="QWmLu6t80Hd6FFgS7MaFl_UMcFLXqOLwd08_u-HXzsk">
    <meta name="description" content="Setting up the UniFi Network Controller in a Raspberry Pi running Raspberry Pi
OS. Optional nginx configuration using certificates generated with mkcert.">
    <meta name="author" content="Alberto Grespan">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@albertogg">
    <meta name="twitter:title" content="UniFi Network Controller Install in a Raspberry Pi">
    <meta name="twitter:description" content="Setting up the UniFi Network Controller in a Raspberry Pi running Raspberry Pi
OS. Optional nginx configuration using certificates generated with mkcert.">
    <meta name="twitter:creator" content="@albertogg">
    <meta name="twitter:image" content="https://www.gravatar.com/avatar/006ef14fba8fadd40053ecda5039deb2.png?s=250">
    <title>UniFi Network Controller Install in a Raspberry Pi &ndash; Alberto Grespan</title>
    <link href="https://fonts.googleapis.com/css?family=Merriweather:300,400,700,900" rel="stylesheet">
    
    <link rel="stylesheet" type="text/css" href="https://albertogrespan.com/site/scss/style.css">
  </head>
  <body>
    <div id="content-wrapper">
      <div class="header">
  <header class="container">
    <h1 class="name">
      <a href="https://albertogrespan.com">Alberto Grespan</a>
    </h1> 
    <ul class="menu">
      <li><a href="https://albertogrespan.com/about/">About</a></li>
      <li><a href="https://albertogrespan.com/resume/">Resume</a></li>
      <li><a href="https://albertogrespan.com/index.xml">RSS</a></li>
    </ul> 
  </header> 
</div> 

      
  <div id="post" class="post">
    <h1>UniFi Network Controller Install in a Raspberry Pi</h1>
    <div class="date">
      <p>&mdash; August 31, 2021</p>
    </div> 
    
    <aside>
      <h4>Table of Contents</h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#rename-hostname">Rename hostname</a></li>
    <li><a href="#install-openjdk-version-8">Install OpenJDK version 8</a></li>
    <li><a href="#install-unifi-network-controller">Install UniFi Network Controller</a>
      <ul>
        <li><a href="#start-unifi-network-controller">Start UniFi Network Controller</a></li>
      </ul>
    </li>
    <li><a href="#additional-steps">Additional steps</a>
      <ul>
        <li><a href="#mkcert-certificate">mkcert certificate</a></li>
        <li><a href="#install-nginx">Install nginx</a></li>
        <li><a href="#set-the-nginx-config">Set the nginx config</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </aside>
    <hr class="toc">
    
    <p>Simple and direct instructions on how to install the UniFi Network Controller in
a Raspberry Pi. I&rsquo;ve only tested this in Raspberry Pi OS, but it should also
work in Ubuntu.</p>
<p>I&rsquo;m not going to show how to install Raspberry Pi OS. I assume at this point you
have a fresh installation of the OS. See the official website for <a href="https://www.raspberrypi.org/software/">installation
instructions</a>, and <a href="https://www.raspberrypi.org/documentation/computers/remote-access.html#remote-access">remote access</a> to the
Raspberry Pi.</p>
<h2 id="rename-hostname">Rename hostname</h2>
<p>We want to ensure the Raspberry Pi has the correct Hostname. In my case I have
dnsmasq in my network and I reach hosts by their hostnames. You can check the
following post on <a href="https://www.ctrl.blog/entry/homenet-domain-name.html">domain names for home networks</a>.</p>
<pre><code>sudo hostnamectl set-hostname unifi-controller
</code></pre>
<h2 id="install-openjdk-version-8">Install OpenJDK version 8</h2>
<p>We will need OpenJDK version 8 for now. It seems that version 11 also works but
I haven&rsquo;t tested it.</p>
<pre><code>sudo apt install openjdk-8-jre
</code></pre>
<h2 id="install-unifi-network-controller">Install UniFi Network Controller</h2>
<p>Install some additional software requirements</p>
<pre><code>sudo apt update &amp;&amp; sudo apt install ca-certificates apt-transport-https
</code></pre>
<p>Add the <a href="https://help.ui.com/hc/en-us/articles/220066768-UniFi-Network-How-to-Install-and-Update-via-APT-on-Debian-or-Ubuntu">Debian repository for the UniFi Network
Controller</a>.</p>
<pre><code>echo 'deb https://www.ui.com/downloads/unifi/debian stable ubiquiti' | sudo tee /etc/apt/sources.list.d/100-ubnt-unifi.list
</code></pre>
<p>Install the package.</p>
<pre><code>sudo apt install unifi -y
</code></pre>
<p>At this point the <code>unifi</code> package installed all of its dependencies and it&rsquo;s
ready to use.</p>
<h3 id="start-unifi-network-controller">Start UniFi Network Controller</h3>
<p>Now that everything is ready we need start the service.</p>
<pre><code>sudo service unifi start
</code></pre>
<p>Open your browser and point to <code>&lt;raspberry-pi-IP-address&gt;:8443</code> and you&rsquo;ll see
the UniFi Network Controller.</p>
<h2 id="additional-steps">Additional steps</h2>
<p>These are some additional steps only if you&rsquo;d like to serve the UniFi Network
Controller from nginx. Additional steps include:</p>
<ul>
<li>An SSL certificate.</li>
<li>nginx and its configuration.</li>
</ul>
<p><strong>Note:</strong> additional steps will only work if you have DNS resolution to the IP
address of the Raspberry Pi.</p>
<h3 id="mkcert-certificate">mkcert certificate</h3>
<p>For the certificate we will use mkcert. <a href="https://github.com/FiloSottile/mkcert">mkcert</a> is a simple zero-config
tool to make locally trusted development certificates with any names you&rsquo;d like.</p>
<p>At this point we are assuming that you have <code>dnsmasq</code> or local DNS resolution
that will allow you resolve <code>unifi-controller.home.arpa</code> to the IP address of
the Raspberry Pi.</p>
<p>Generate the cert.</p>
<pre><code>mkcert &quot;unifi-controller.home.arpa&quot;
</code></pre>
<p>With that cert ready we will proceed with the nginx install.</p>
<h3 id="install-nginx">Install nginx</h3>
<p>Now we need nginx. Any reverse proxy server will work.</p>
<pre><code>sudo apt install nginx
</code></pre>
<h3 id="set-the-nginx-config">Set the nginx config</h3>
<p>On to the configuration we would like to have custom redirects from HTTP to
HTTPS, some proxy headers, and our custom certs.</p>
<p>You can copy the cert from your local computer into the Raspberry Pi using SCP.</p>
<pre><code>scp ~/unifi-controller.home.arpa* pi@unifi-controller.home.arpa:/home/pi/
</code></pre>
<p>Now for the configuration piece. Create the following code in
<code>/etc/nginx/sites-avaliable/unifi</code></p>
<pre><code>server {
  listen 80;
  server_name unifi-controller.home.arpa;

  return 301 https://$server_name$request_uri;
}

server {
  # SSL configuration
  listen 443 ssl;

  server_name unifi-controller.home.arpa;

  ssl on;
  ssl_protocols TLSv1.2 TLSv1.3;
  ssl_certificate /home/pi/unifi-controller.home.arpa.pem;
  ssl_certificate_key /home/pi/unifi-controller.home.arpa-key.pem;

  location / {
    proxy_pass https://localhost:8443;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Host $http_host;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &quot;Upgrade&quot;;
    proxy_buffering off;
  }
}
</code></pre>
<p>Once you have it. Now link it into the enabled sites.</p>
<pre><code>sudo ln -s /etc/nginx/sites-available/unifi /etc/nginx/sites-enabled/unifi
</code></pre>
<p>Restart nginx.</p>
<pre><code>sudo systemctl restart nginx
</code></pre>
<p>That&rsquo;s it. At this point you can open your browser and point to
<code>unifi-controller.local.arpa</code> and you&rsquo;ll see the UniFi Network Controller.</p>

    <div class="closing">
      <div>
       By <a href="https://twitter.com/albertogg" class="twitter-follow-link">@albertogg</a>
      </div>
      <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-url="https://albertogrespan.com/blog/unifi-network-controller-install-in-a-raspberry-pi/" data-text="UniFi Network Controller Install in a Raspberry Pi" data-via="albertogg" data-show-count="false">Tweet</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div> 
  </div> 

    </div> 
    <footer id="footer">
  <div class="container">
    <p>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>
    <p>2012 &#151; 2021 albertogrespan.com</p>
  </div> 
</footer> 

  </body>
</html>
